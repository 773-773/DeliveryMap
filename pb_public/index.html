<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FoodDeliveryEye</title>

<style>
:root {
  --bg-main: #07070b;
  --bg-elevated: #0c0c12;
  --accent: #5bff9c;
  --accent-soft: rgba(91, 255, 156, 0.28);
  --accent2: #23ffd1;
  --text-main: #f5f5f7;
  --text-muted: rgba(245,245,247,0.62);
  --border-soft: rgba(255,255,255,0.08);
  --border-hair: rgba(255,255,255,0.06);
  --shadow-deep: 0 26px 90px rgba(0,0,0,0.78);
}

* { box-sizing:border-box; }
body {
  margin:0;
  min-height:100vh;
  font-family:-apple-system,BlinkMacSystemFont,"Inter","Noto Sans JP",sans-serif;
  color:var(--text-main);
  background:
    radial-gradient(circle at 18% 0%, rgba(91,255,156,0.09) 0, transparent 55%),
    radial-gradient(circle at 90% 90%, rgba(255,255,255,0.03) 0, transparent 55%),
    linear-gradient(180deg, #050507 0%, #07070b 60%, #050507 100%);
}

.page {
  max-width:1040px;
  margin:0 auto;
  padding:18px 14px 42px;
}

/* Header */
header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:12px 14px;
  border-radius:18px;
  background:rgba(5,5,8,0.72);
  border:1px solid var(--border-hair);
  backdrop-filter:blur(22px);
  box-shadow:0 18px 60px rgba(0,0,0,0.62);
  margin-bottom:18px;
}

.logoArea { display:flex; align-items:center; gap:10px; min-width:0; }
.logoMark {
  width:34px; height:34px; border-radius:50%;
  background:
    radial-gradient(circle at 30% 0%, rgba(255,255,255,0.95) 0, transparent 48%),
    radial-gradient(circle at 80% 80%, rgba(91,255,156,0.95) 0, transparent 55%),
    #0f1020;
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 0 22px rgba(91,255,156,0.35);
  flex:0 0 auto;
}
.logoMark span { font-size:15px; font-weight:900; color:#050814; }
.logoTextMain { font-weight:900; font-size:16px; letter-spacing:0.08em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.logoTextSub { font-size:11px; color:var(--text-muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.headerRight{
  display:flex;
  align-items:center;
  gap:10px;
  flex:0 0 auto;
  min-width:0;
}

/* nav */
nav {
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
nav a {
  color:var(--text-muted);
  text-decoration:none;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.06);
  background:rgba(255,255,255,0.02);
  font-size:12px;
  transition:all 0.16s ease;
  white-space:nowrap;
}
nav a:hover {
  color:var(--text-main);
  background:rgba(255,255,255,0.05);
}
nav .primary {
  color:#050814;
  background:var(--accent);
  border-color:transparent;
  font-weight:800;
  box-shadow:0 0 18px var(--accent-soft);
}
nav .primary:hover { background:#7affb2; }

/* === Share icons (å¸¸æ™‚è¡¨ç¤º) === */
.shareRow{
  display:flex;
  align-items:center;
  gap:8px;
  flex:0 0 auto;
}
.shareLabel{
  display:none; /* PCã§ã‚‚é‚ªé­”ãªã‚‰éè¡¨ç¤º */
}
.iconBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:36px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(255,255,255,0.02);
  cursor:pointer;
  transition:all 0.16s ease;
  box-shadow:0 10px 26px rgba(0,0,0,0.35);
}
.iconBtn:hover{
  background:rgba(255,255,255,0.06);
  transform:translateY(-1px);
}
.iconBtn:active{ transform:translateY(0px); }
.iconBtn svg{ width:18px; height:18px; fill:#f5f5f7; opacity:0.92; }

.iconBtn.copy svg{ opacity:0.85; }
.copyToast{
  font-size:10px;
  color:var(--text-muted);
  min-height:14px;
  margin-left:6px;
}

/* Hero */
.hero {
  padding:22px 16px;
  border-radius:22px;
  background:
   linear-gradient(135deg, rgba(91,255,156,0.10), rgba(5,5,8,0.92)),
   radial-gradient(circle at 120% -20%, rgba(91,255,156,0.16) 0, transparent 60%),
   var(--bg-elevated);
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:var(--shadow-deep);
  position:relative;
  overflow:hidden;
}
.heroGlow {
  position:absolute;
  inset:auto -80px -140px;
  height:240px;
  background:radial-gradient(circle at 50% 0%, rgba(91,255,156,0.22), transparent 60%);
  opacity:0.55;
  pointer-events:none;
}
.heroGrid {
  position:relative;
  display:grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap:14px;
  align-items:stretch;
}

.heroContent { z-index:1; }
.heroTag {
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-size:11px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(91,255,156,0.22);
  background:rgba(10,10,16,0.85);
  color:rgba(245,245,247,0.86);
  margin-bottom:12px;
}
.heroTag span.dot {
  width:7px; height:7px; border-radius:50%;
  background:var(--accent);
  box-shadow:0 0 10px var(--accent);
}

.heroTitle {
  font-size:24px;
  line-height:1.45;
  margin:0 0 10px;
  letter-spacing:0.02em;
}
.heroTitle strong { color:var(--accent); }
.heroLead {
  font-size:13px;
  line-height:1.75;
  color:var(--text-muted);
  margin:0 0 16px;
}
.heroActions { display:flex; flex-wrap:wrap; gap:10px; }

.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:11px 16px;
  border-radius:999px;
  border:none;
  font-size:13px;
  font-weight:900;
  cursor:pointer;
  text-decoration:none;
  transition:all 0.18s ease;
}
.btnGlow {
  background:rgba(91,255,156,0.95);
  color:#050814;
  box-shadow:
    0 0 0 1px rgba(91,255,156,0.15),
    0 0 28px rgba(91,255,156,0.26),
    0 18px 40px rgba(0,0,0,0.45);
}
.btnGlow:hover { background:#7affb2; transform:translateY(-1px); }

.heroMeta { margin-top:10px; font-size:11px; color:var(--text-muted); }

.heroPanel {
  z-index:1;
  padding:14px 14px 16px;
  border-radius:18px;
  background:rgba(10,10,16,0.88);
  border:1px solid rgba(255,255,255,0.10);
  box-shadow:0 15px 40px rgba(0,0,0,0.75);
  backdrop-filter:blur(18px);
  font-size:11px;
}
.heroPanelHeader {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.heroPanelTitle { font-size:11px; color:rgba(245,245,247,0.78); }

.pollBtn{
  width:100%;
  text-align:left;
  padding:10px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(255,255,255,0.03);
  color:#f5f5f7;
  font-size:12px;
  font-weight:900;
  cursor:pointer;
  transition:transform 0.15s ease, background 0.15s ease, border-color 0.15s ease;
}
.pollBtn:hover{
  background:rgba(255,255,255,0.06);
  border-color:rgba(91,255,156,0.22);
  transform:translateY(-1px);
}

.pollCta{
  flex:1;
  text-align:center;
  text-decoration:none;
  padding:10px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.12);
  color:#f5f5f7;
  background:rgba(5,5,8,0.85);
  font-size:12px;
  font-weight:900;
}
.pollCta:hover{ background:rgba(18,18,26,0.95); }
.pollCtaPrimary{
  background:rgba(91,255,156,0.9);
  color:#050814;
  border-color:transparent;
  box-shadow:0 0 18px rgba(91,255,156,0.22);
}
.pollCtaPrimary:hover{ background:#7affb2; }

/* Section + Cards */
.sectionTitle { margin:22px 4px 10px; font-size:15px; text-align:left; color:rgba(245,245,247,0.90); }
.sectionTitle span { font-size:11px; color:var(--text-muted); margin-left:6px; }

.cards { display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-top:8px; }
.card {
  position:relative;
  padding:16px 14px 14px;
  border-radius:18px;
  background:rgba(10,10,16,0.88);
  border:1px solid var(--border-hair);
  box-shadow:0 18px 50px rgba(0,0,0,0.65);
  text-align:left;
  overflow:hidden;
}
.card::before {
  content:"";
  position:absolute;
  inset:-40%;
  opacity:0.05;
  background:radial-gradient(circle at 0 0, var(--accent) 0, transparent 55%);
  pointer-events:none;
}
.cardAccent {
  position:absolute;
  right:-30px;
  top:-30px;
  width:120px;
  height:120px;
  border-radius:40%;
  background:radial-gradient(circle at 30% 30%, rgba(91,255,156,0.55), transparent 60%);
  opacity:0.16;
  filter:blur(3px);
}
.cardTag {
  display:inline-flex;
  align-items:center;
  gap:5px;
  font-size:10px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(91,255,156,0.18);
  color:rgba(245,245,247,0.75);
  margin-bottom:8px;
}
.cardTitle { font-size:15px; margin:2px 0 6px; }
.cardDesc { font-size:12px; line-height:1.7; color:var(--text-muted); margin:0 0 10px; }
.cardLink { display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--accent); text-decoration:none; font-weight:800; }
.cardLink span.arrow { font-size:13px; }

footer {
  margin-top:26px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,0.05);
  font-size:11px;
  color:rgba(245,245,247,0.36);
}

/* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šã‚¹ãƒãƒ›ã¯ã€Œç¸¦ã€ ===== */
@media (max-width: 860px){
  .heroGrid { grid-template-columns: 1fr; }
  .cards { grid-template-columns: 1fr; }
}

@media (max-width: 640px){
  header{
    flex-direction:column;
    align-items:stretch;
    gap:10px;
  }
  .headerRight{
    flex-direction:column;     /* â†ç¸¦ã«ç©ã‚€ */
    align-items:stretch;
    gap:10px;
  }
  .shareRow{
    justify-content:flex-start;
  }
  nav{
    justify-content:flex-start;
  }
  nav a{
    flex:0 0 auto;
  }
}

@media (max-width: 420px){
  .page { padding:14px 12px 38px; }
  header { padding:10px 12px; border-radius:16px; }
  .hero { padding:18px 14px; border-radius:20px; }
  .heroActions { flex-direction:column; }
  .btn { width:100%; }
}
</style>
</head>

<body>
<div class="page">

  <header>
    <div class="logoArea">
      <div class="logoMark"><span>FE</span></div>
      <div style="min-width:0;">
        <div class="logoTextMain">FoodDeliveryEye</div>
        <div class="logoTextSub">é…é”å“¡ã®ä½“é¨“ã‚’ã€ã¿ã‚“ãªã®å®‰å¿ƒã¨åŠ¹ç‡ã¸</div>
      </div>
    </div>

    <div class="headerRight">

      <!-- â˜… ã“ã“ã‚’ã€Œã‚¢ã‚¤ã‚³ãƒ³ã§å¸¸æ™‚è¡¨ç¤ºã€ã«å¤‰æ›´ -->
      <div class="shareRow">
        <span class="shareLabel">ã‚·ã‚§ã‚¢</span>

        <!-- X -->
        <a class="iconBtn" id="shareX" href="#" target="_blank" rel="noopener" aria-label="Xã§ã‚·ã‚§ã‚¢">
          <!-- X icon -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M18.9 2H22l-6.8 7.8L23 22h-6.8l-5.3-6.7L4.8 22H2l7.4-8.5L1 2h7l4.8 6.1L18.9 2Zm-2.4 18h1.9L7.3 3.9H5.2L16.5 20Z"/>
          </svg>
        </a>

        <!-- LINE -->
        <a class="iconBtn" id="shareLine" href="#" target="_blank" rel="noopener" aria-label="LINEã§é€ã‚‹">
          <!-- LINEé¢¨ã®å¹ãå‡ºã—ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆç°¡æ˜“ï¼‰ -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3C6.9 3 3 6.3 3 10.4c0 2.5 1.4 4.7 3.7 6.1l-.6 3.3c-.1.5.4.9.9.6l3.8-2.1c.7.1 1.4.2 2.2.2 5.1 0 9-3.3 9-7.4S17.1 3 12 3Zm-3 8.5h-1V9h1v2.5Zm3 0h-1V9h1v2.5Zm3 0h-1V9h1v2.5Z"/>
          </svg>
        </a>

        <!-- Copy -->
        <button class="iconBtn copy" id="copyLink" type="button" aria-label="ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M16 1H6C4.9 1 4 1.9 4 3v12h2V3h10V1Zm3 4H10c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2Zm0 16H10V7h9v14Z"/>
          </svg>
        </button>

        <span class="copyToast" id="copyToast"></span>
      </div>

      <nav>
        <a href="about.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
        <a href="login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
        <a href="signup.html" class="primary">æ–°è¦ç™»éŒ²</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="heroGlow"></div>

    <div class="heroGrid">
      <div class="heroContent">
        <div class="heroTag">
          <span class="dot"></span>
          é…é”å“¡ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ Ã— ä½“é¨“ãƒ‡ãƒ¼ã‚¿å…±æœ‰
        </div>

        <h2 class="heroTitle">
          é…é”ã®ç¾å ´ã§å½¹ç«‹ã¤æƒ…å ±ã‚’ã€<strong>ã¿ã‚“ãªã§é›†ã‚ã¦</strong>ã€ã¿ã‚“ãªã§ä½¿ã†ã€‚
        </h2>

        <p class="heroLead">
          èª¿ç†å¾…ã¡ã®ä½“æ„Ÿã€å»ºç‰©ã®å…¥é¤¨æ‰‹é †ã€å—ã‘å–ã‚Šã®ã‚³ãƒ„ãªã©ã‚’å…±æœ‰ã—ã¦ã€
          é…é”ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚‹ãƒ’ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚
        </p>

        <div class="heroActions">
          <a href="login.html" class="btn btnGlow">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å‚åŠ ã™ã‚‹</a>
        </div>

        <div class="heroMeta">
          åŒ¿åOK / ç„¡æ–™ / ã‚¹ãƒãƒ›å¯¾å¿œ
        </div>
      </div>

      <aside class="heroPanel" id="pollPanel">
        <div class="heroPanelHeader">
          <div class="heroPanelTitle">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå®Ÿæ–½ä¸­</div>
          <div style="display:flex;gap:4px;">
            <span style="width:6px;height:6px;border-radius:50%;background:#ffb84d;"></span>
            <span style="width:6px;height:6px;border-radius:50%;background:#6bffb3;"></span>
            <span style="width:6px;height:6px;border-radius:50%;background:#6b7bff;"></span>
          </div>
        </div>

        <div style="margin-top:6px;">
          <div style="font-size:12px;font-weight:900;color:#e9ecff;line-height:1.4;">
            ä»Šã®æ™‚é–“å¸¯ã€ã„ã¡ã°ã‚“å›°ã‚Šã‚„ã™ã„ã®ã¯ï¼Ÿ
          </div>
          <div id="pollHint" style="margin-top:6px;font-size:10px;color:#a7aed0;line-height:1.5;">
            4æŠã‹ã‚‰é¸ã¶ã¨ã€çµæœã‚’è¦‹ã‚‹ãŸã‚ã®ãƒ­ã‚°ã‚¤ãƒ³æ¡ˆå†…ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
          </div>
        </div>

        <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
          <button class="pollBtn" data-choice="cook" type="button">èª¿ç†å¾…ã¡</button>
          <button class="pollBtn" data-choice="entry" type="button">å…¥é¤¨æ‰‹é †</button>
          <button class="pollBtn" data-choice="parking" type="button">é§è¼ªãƒ»é§è»Š</button>
          <button class="pollBtn" data-choice="handoff" type="button">å—ã‘æ¸¡ã—é€£çµ¡</button>
        </div>

        <div id="pollMsg" style="margin-top:10px; font-size:10px; color:#a7aed0; line-height:1.5;"></div>

        <div id="pollResults" style="display:none; margin-top:12px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <div style="font-size:11px; color:#cdd3ff; font-weight:900;">ã¿ã‚“ãªã®çµæœ</div>
          </div>
          <div id="pollBars" style="display:flex; flex-direction:column; gap:8px;"></div>
        </div>
      </aside>

    </div>
  </section>

  <h3 class="sectionTitle">
    ã§ãã‚‹ã“ã¨
    <span>ç›®çš„ã‹ã‚‰é¸ã¹ã¾ã™</span>
  </h3>

  <div class="cards">
    <article class="card">
      <div class="cardAccent"></div>
      <div class="cardTag">Feature Â· å¾…ã¡æ™‚é–“</div>
      <h4 class="cardTitle">èª¿ç†å¾…ã¡æ™‚é–“ã®å…±æœ‰</h4>
      <p class="cardDesc">
        å¾…ã¡æ™‚é–“ã®ä½“æ„Ÿã‚’æŠ•ç¥¨ã§é›†è¨ˆã€‚æ™‚é–“å¸¯ã‚„ãŠåº—ã”ã¨ã®å‚¾å‘ã‚’è¦‹ãªãŒã‚‰ã€
        æ¬¡ã®å‹•ãæ–¹ã®å‚è€ƒã«ã§ãã¾ã™ã€‚
      </p>
      <a href="vote.html" class="cardLink">
        èª¿ç†å¾…ã¡æ™‚é–“ãƒšãƒ¼ã‚¸ã¸ <span class="arrow">â†—</span>
      </a>
    </article>

    <article class="card">
      <div class="cardAccent"></div>
      <div class="cardTag">Guide Â· å…¥é¤¨</div>
      <h4 class="cardTitle">å…¥é¤¨æ–¹æ³•ãƒ¡ãƒ¢ï¼ˆé˜²ç½ã‚»ãƒ³ã‚¿ãƒ¼çµŒç”±ãªã©ï¼‰</h4>
      <p class="cardDesc">
        ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®æ¡ˆå†…ã€å—ä»˜ã®æ‰‹é †ã€é˜²ç½ã‚»ãƒ³ã‚¿ãƒ¼çµŒç”±ãŒå¿…è¦ã‹ã©ã†ã‹ç­‰ã€
        å»ºç‰©ã”ã¨ã®ã€Œå…¥é¤¨ã®æµã‚Œã€ã‚’å…±æœ‰ã§ãã¾ã™ã€‚
      </p>
      <a href="tower.html" class="cardLink">
        å…¥é¤¨æ–¹æ³•ã‚’è¦‹ã‚‹ <span class="arrow">â†—</span>
      </a>
    </article>

    <article class="card">
      <div class="cardAccent"></div>
      <div class="cardTag">Community Â· äº¤æµ</div>
      <h4 class="cardTitle">æ²ç¤ºæ¿ï¼ˆæƒ…å ±äº¤æ›ï¼‰</h4>
      <p class="cardDesc">
        å¾…æ©Ÿã®ã‚³ãƒ„ã‚„ãƒ«ãƒ¼ãƒˆã®å·¥å¤«ãªã©ã€é…é”ã®å·¥å¤«ã‚’æ°—è»½ã«å…±æœ‰ã€‚
        å½¹ç«‹ã¤æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
      </p>
      <a href="bbs.html" class="cardLink">
        æ²ç¤ºæ¿ã¸è¡Œã <span class="arrow">â†—</span>
      </a>
    </article>
  </div>

  <footer>
    Â© FoodDeliveryEye â€“ é…é”å“¡ã®ãŸã‚ã®æƒ…å ±ãƒ¬ãƒ¼ãƒ€ãƒ¼
  </footer>

</div>

<script type="module">
  import PocketBase from "https://cdn.jsdelivr.net/npm/pocketbase@0.21.1/dist/pocketbase.es.mjs";
  const pb = new PocketBase("https://delivery-eye.onrender.com");

  // ===== ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆï¼ˆãã®ã¾ã¾ï¼‰ =====
  const POLL_TOPIC = "today_issue_v1";
  const msgBox = document.getElementById("pollMsg");
  const resultsBox = document.getElementById("pollResults");
  const barsBox = document.getElementById("pollBars");

  const labels = {
    cook: "èª¿ç†å¾…ã¡",
    entry: "å…¥é¤¨æ‰‹é †",
    parking: "é§è¼ªãƒ»é§è»Š",
    handoff: "å—ã‘æ¸¡ã—é€£çµ¡"
  };

  async function loadResults(){
    const records = await pb.collection("polls").getFullList({
      filter: `topic="${POLL_TOPIC}"`
    });

    const counts = { cook:0, entry:0, parking:0, handoff:0 };
    records.forEach(r => {
      if (counts[r.choice] !== undefined) counts[r.choice]++;
    });

    renderBars(counts);
    resultsBox.style.display = "block";
  }

  function renderBars(counts){
    barsBox.innerHTML = "";
    const total = Object.values(counts).reduce((a,b)=>a+b,0) || 1;

    for (const key of Object.keys(labels)){
      const pct = Math.round((counts[key] / total) * 100);

      const row = document.createElement("div");
      row.style.display = "grid";
      row.style.gridTemplateColumns = "auto 1fr auto";
      row.style.gap = "8px";
      row.style.alignItems = "center";

      row.innerHTML = `
        <div style="font-size:11px;font-weight:900;color:#e9ecff;">${labels[key]}</div>
        <div style="height:10px;border-radius:999px;background:rgba(255,255,255,0.06);overflow:hidden;border:1px solid rgba(255,255,255,0.08);">
          <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#5bff9c,#23ffd1);"></div>
        </div>
        <div style="font-size:10px;color:rgba(245,245,247,0.62);font-weight:900;">${pct}%</div>
      `;
      barsBox.appendChild(row);
    }
  }

  async function saveVote(choice){
    await pb.collection("polls").create({
      topic: POLL_TOPIC,
      choice,
      user: pb.authStore.model.id
    });
  }

  document.querySelectorAll(".pollBtn").forEach(btn => {
    btn.addEventListener("click", async () => {
      const choice = btn.dataset.choice;

      if (!pb.authStore.isValid) {
        msgBox.innerHTML = `
          <div style="margin-top:6px;">
            ğŸ”’ <strong style="color:#e9ecff;">çµæœã‚’è¦‹ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</strong><br>
            <span style="font-size:10px;">ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«æŠ•ç¥¨ãŒåæ˜ ã•ã‚Œã€ã¿ã‚“ãªã®çµæœãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚</span>
          </div>
          <div style="display:flex; gap:8px; margin-top:10px;">
            <a href="login.html" class="pollCta">ãƒ­ã‚°ã‚¤ãƒ³</a>
            <a href="signup.html" class="pollCta pollCtaPrimary">æ–°è¦ç™»éŒ²</a>
          </div>
        `;
        resultsBox.style.display = "none";
        return;
      }

      msgBox.textContent = "æŠ•ç¥¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼çµæœã‚’èª­ã¿è¾¼ã¿ä¸­â€¦";
      try {
        await saveVote(choice);
        await loadResults();
        msgBox.textContent = "æŠ•ç¥¨ã‚’åæ˜ ã—ã¾ã—ãŸã€‚";
      } catch (e) {
        msgBox.textContent = "æŠ•ç¥¨ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    });
  });

  // ===== ã‚·ã‚§ã‚¢ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã§å¸¸æ™‚è¡¨ç¤ºï¼‰ =====
  const pageUrl = window.location.href;
  const text = "FoodDeliveryEyeï¼šé…é”å“¡ã®ä½“é¨“ã‚’ã€ã¿ã‚“ãªã®å®‰å¿ƒã¨åŠ¹ç‡ã¸";

  const shareX = document.getElementById("shareX");
  const shareLine = document.getElementById("shareLine");
  const copyLink = document.getElementById("copyLink");
  const toast = document.getElementById("copyToast");

  shareX.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(pageUrl)}`;
  shareLine.href = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(pageUrl)}`;

  function showToast(msg){
    toast.textContent = msg;
    setTimeout(()=>{ if(toast.textContent === msg) toast.textContent=""; }, 1600);
  }

  copyLink.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(pageUrl);
      showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    } catch {
      const tmp = document.createElement("textarea");
      tmp.value = pageUrl;
      document.body.appendChild(tmp);
      tmp.select();
      document.execCommand("copy");
      tmp.remove();
      showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }
  });
</script>

</body>
</html>
