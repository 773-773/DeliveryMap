<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ✅ Google Search Console 所有権確認（head内に配置） -->
  <meta name="google-site-verification" content="WjEO0gKNZqkmnxzf6ndfmbzgUvXw5juJmXK_3Xr89Zc" />

  <!-- ✅ AdSense 所有権確認（これが無いと「コード未配置」扱いになりやすい） -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4389309905551232"
    crossorigin="anonymous"></script>

  <title>FoodDeliveryEye</title>

  <style>
  :root {
    --bg-main: #07070b;
    --bg-elevated: #0c0c12;
    --accent: #5bff9c;
    --accent-soft: rgba(91, 255, 156, 0.28);
    --accent2: #23ffd1;
    --text-main: #f5f5f7;
    --text-muted: rgba(245,245,247,0.62);
    --border-soft: rgba(255,255,255,0.08);
    --border-hair: rgba(255,255,255,0.06);
    --shadow-deep: 0 26px 90px rgba(0,0,0,0.78);

    --fb-blue: #1877F2;
    --line-green: #06C755;

    /* ✅ カード別：色を“もう少し強く”（派手ではないが分かりやすい） */
    --c-feature: rgba(91,255,156,0.62);
    --c-guide:   rgba(120,165,255,0.62);
    --c-comm:    rgba(255,198,120,0.62);
    --c-poll:    rgba(190,140,255,0.62);

    --c-feature-soft: rgba(91,255,156,0.22);
    --c-guide-soft:   rgba(120,165,255,0.22);
    --c-comm-soft:    rgba(255,198,120,0.22);
    --c-poll-soft:    rgba(190,140,255,0.22);
  }

  * { box-sizing:border-box; }
  html, body { height:100%; }
  body {
    margin:0;
    min-height:100vh;
    font-family:-apple-system,BlinkMacSystemFont,"Inter","Noto Sans JP",sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    color:var(--text-main);
    background:
      radial-gradient(circle at 18% 0%, rgba(91,255,156,0.09) 0, transparent 55%),
      radial-gradient(circle at 90% 90%, rgba(255,255,255,0.03) 0, transparent 55%),
      linear-gradient(180deg, #050507 0%, #07070b 60%, #050507 100%);
  }
  .page {
    max-width:1040px;
    margin:0 auto;
    padding:18px 14px 42px;
  }

  /* ✅ JSが死んだ時も「何も見えない」を防ぐための保険表示 */
  .hardFallback{
    display:none;
    margin:12px 0 16px;
    padding:12px 12px;
    border-radius:16px;
    background:rgba(255,120,120,0.10);
    border:1px solid rgba(255,120,120,0.22);
    color:rgba(255,220,220,0.92);
    box-shadow:0 16px 50px rgba(0,0,0,0.55);
    line-height:1.7;
    font-size:12px;
  }
  .hardFallback strong{ color:#ffd9d9; }
  .hardFallback code{ color:#fff; background:rgba(255,255,255,0.08); padding:1px 6px; border-radius:8px; }

  /* Header */
  header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px 14px;
    border-radius:18px;
    background:rgba(5,5,8,0.72);
    border:1px solid var(--border-hair);
    backdrop-filter:blur(22px);
    box-shadow:0 18px 60px rgba(0,0,0,0.62);
    margin-bottom:18px;
    position:relative;
    z-index:50;
  }

  /* ロゴ */
  .logoArea { display:flex; align-items:center; gap:0; min-width:0; }
  .logoLink{
    display:inline-block;
    min-width:0;
    color:inherit;
    text-decoration:none;
  }
  .logoTextMain {
    font-weight:900;
    font-size:18px;
    letter-spacing:0.06em;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .logoTextSub {
    font-size:12px;
    line-height:1.5;
    color:rgba(245,245,247,0.55);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    margin-top:2px;
  }

  .headerRight{ display:flex; align-items:center; gap:10px; flex:0 0 auto; min-width:0; }

  /* nav */
  nav { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  nav a, nav button {
    color:var(--text-muted);
    text-decoration:none;
    padding:8px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02);
    font-size:12px;
    line-height:1;
    transition:all 0.16s ease;
    white-space:nowrap;
    cursor:pointer;
    font-family:inherit;
  }
  nav a:hover, nav button:hover { color:var(--text-main); background:rgba(255,255,255,0.05); }
  nav .primary {
    color:#050814;
    background:var(--accent);
    border-color:transparent;
    font-weight:900;
    box-shadow:0 0 18px var(--accent-soft);
  }
  nav .primary:hover { background:#7affb2; }
  nav button{
    appearance:none;
    -webkit-appearance:none;
  }

  /* ✅ ログイン中 表示 */
  .loggedPill{
    display:inline-flex !important;
    align-items:center;
    gap:8px;
    color:#07110a !important;
    background:linear-gradient(180deg, rgba(91,255,156,0.95), rgba(91,255,156,0.78)) !important;
    border-color:rgba(91,255,156,0.18) !important;
    box-shadow:0 0 18px rgba(91,255,156,0.22), 0 12px 28px rgba(0,0,0,0.45);
    font-weight:900;
  }
  .loggedLamp{
    width:10px; height:10px; border-radius:50%;
    background:var(--accent);
    box-shadow:0 0 10px rgba(91,255,156,0.9), 0 0 24px rgba(91,255,156,0.38);
    position:relative;
  }
  .loggedLamp::after{
    content:"";
    position:absolute;
    inset:-8px;
    border-radius:999px;
    border:1px solid rgba(91,255,156,0.25);
    animation:pulse 1.6s ease-in-out infinite;
    opacity:0.65;
  }
  @keyframes pulse{
    0%{ transform:scale(0.72); opacity:0.25; }
    55%{ transform:scale(1.08); opacity:0.75; }
    100%{ transform:scale(1.35); opacity:0; }
  }

  .logoutPill{
    color:rgba(245,245,247,0.88) !important;
    border-color:rgba(255,255,255,0.10) !important;
    background:rgba(255,255,255,0.03) !important;
  }
  .logoutPill:hover{
    border-color:rgba(91,255,156,0.18) !important;
  }

  /* Hero */
  .hero {
    padding:22px 16px;
    border-radius:22px;
    background:
     linear-gradient(135deg, rgba(91,255,156,0.10), rgba(5,5,8,0.92)),
     radial-gradient(circle at 120% -20%, rgba(91,255,156,0.16) 0, transparent 60%),
     var(--bg-elevated);
    border:1px solid rgba(255,255,255,0.08);
    box-shadow:var(--shadow-deep);
    position:relative;
    overflow:hidden;
  }
  .heroGlow {
    position:absolute;
    inset:auto -80px -140px;
    height:240px;
    background:radial-gradient(circle at 50% 0%, rgba(91,255,156,0.22), transparent 60%);
    opacity:0.55;
    pointer-events:none;
  }
  .heroGrid {
    position:relative;
    display:grid;
    grid-template-columns: 1.1fr 0.9fr;
    gap:14px;
    align-items:stretch;
  }
  .heroContent { z-index:1; min-width:0; }
  .heroTag {
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-size:12px;
    line-height:1.2;
    padding:7px 10px;
    border-radius:999px;
    border:1px solid rgba(91,255,156,0.22);
    background:rgba(10,10,16,0.85);
    color:rgba(245,245,247,0.88);
    margin-bottom:12px;
    white-space:nowrap;
    max-width:100%;
  }
  .heroTag span.dot {
    width:7px; height:7px; border-radius:50%;
    background:var(--accent);
    box-shadow:0 0 10px var(--accent);
  }

  .heroTitle {
    font-size:clamp(18px, 5.2vw, 28px);
    line-height:1.65;
    margin:0 0 10px;
    letter-spacing:0.01em;
    word-break: normal;
    overflow-wrap: anywhere;
    line-break: loose;
  }
  .heroTitle strong { color:var(--accent); }

  .heroLead {
    font-size:clamp(13px, 3.8vw, 14px);
    line-height:1.9;
    color:var(--text-muted);
    margin:0;
    word-break: normal;
    overflow-wrap: anywhere;
    line-break: loose;
  }
  .br-sm{ display:none; }

  /* Poll panel */
  .heroPanel {
    z-index:1;
    padding:14px 14px 16px;
    border-radius:18px;
    background:rgba(10,10,16,0.88);
    border:1px solid rgba(255,255,255,0.10);
    box-shadow:0 15px 40px rgba(0,0,0,0.75);
    backdrop-filter:blur(18px);
    font-size:11px;
  }
  .heroPanelHeader {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:8px;
  }
  .heroPanelTitle { font-size:11px; color:rgba(245,245,247,0.78); }

  /* poll buttons */
  .pollBtn{
    position:relative;
    width:100%;
    text-align:left;
    padding:11px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
    color:#f5f5f7;
    font-size:13px;
    font-weight:900;
    cursor:pointer;
    transition:transform 0.15s ease, background 0.15s ease, border-color 0.15s ease;
    overflow:hidden;
  }
  .pollBtn::before{
    content:"";
    position:absolute;
    inset:0;
    width:var(--pct, 0%);
    background:linear-gradient(90deg, rgba(91,255,156,0.28), rgba(35,255,209,0.18));
    opacity:0.9;
    pointer-events:none;
  }
  .pollBtn:hover{
    background:rgba(255,255,255,0.06);
    border-color:rgba(91,255,156,0.22);
    transform:translateY(-1px);
  }
  .pollBtn:disabled{ cursor:default; opacity:0.95; }
  .pollBtnInner{
    position:relative;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .pollBtnLabel{
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    max-width:72%;
  }
  .pollBtnPct{
    font-size:12px;
    color:rgba(245,245,247,0.70);
    font-weight:900;
    flex:0 0 auto;
  }

  /* login CTA */
  .pollCta{
    flex:1;
    text-align:center;
    text-decoration:none;
    padding:10px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.12);
    color:#f5f5f7;
    background:rgba(5,5,8,0.85);
    font-size:12px;
    font-weight:900;
  }
  .pollCta:hover{ background:rgba(18,18,26,0.95); }
  .pollCtaPrimary{
    background:rgba(91,255,156,0.9);
    color:#050814;
    border-color:transparent;
    box-shadow:0 0 18px rgba(91,255,156,0.22);
  }
  .pollCtaPrimary:hover{ background:#7affb2; }

  /* Section + Cards */
  .sectionTitle {
    margin:22px 4px 10px;
    font-size:15px;
    text-align:left;
    color:rgba(245,245,247,0.92);
    line-height:1.4;
  }
  .sectionTitle span {
    display:inline-block;
    font-size:12px;
    color:var(--text-muted);
    margin-left:6px;
  }

  .cards { display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-top:8px; }

  .cardLinkWrap{
    display:block;
    text-decoration:none;
    color:inherit;
    outline:none;
  }
  .card {
    position:relative;
    padding:16px 14px 14px;
    border-radius:18px;
    background:rgba(10,10,16,0.88);
    border:1px solid var(--border-hair);
    box-shadow:0 18px 50px rgba(0,0,0,0.65);
    text-align:left;
    overflow:hidden;
    cursor:pointer;
    transition: transform .14s ease, border-color .14s ease, background .14s ease, filter .14s ease;
  }

  .card[data-tone="feature"]{ --tone: var(--c-feature); --toneSoft: var(--c-feature-soft); }
  .card[data-tone="guide"]{   --tone: var(--c-guide);   --toneSoft: var(--c-guide-soft); }
  .card[data-tone="comm"]{    --tone: var(--c-comm);    --toneSoft: var(--c-comm-soft); }
  .card[data-tone="poll"]{    --tone: var(--c-poll);    --toneSoft: var(--c-poll-soft); }

  .card::before{
    content:"";
    position:absolute;
    inset:-48%;
    opacity:0.10;
    background:radial-gradient(circle at 0 0, var(--tone) 0, transparent 58%);
    pointer-events:none;
  }
  .card::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:18px;
    border:1px solid rgba(255,255,255,0.02);
    pointer-events:none;
  }

  .cardLinkWrap:hover .card{
    transform: translateY(-1px);
    border-color: rgba(255,255,255,0.14);
    background: rgba(12,12,18,0.92);
    filter: brightness(1.04);
  }
  .cardLinkWrap:active .card{ transform: translateY(0px); }
  .cardLinkWrap:focus-visible .card{
    box-shadow: 0 0 0 3px rgba(91,255,156,0.16), 0 18px 50px rgba(0,0,0,0.65);
    border-color: rgba(255,255,255,0.16);
  }

  .cardTag {
    display:inline-flex;
    align-items:center;
    gap:7px;
    font-size:11px;
    line-height:1;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.12);
    color:rgba(245,245,247,0.82);
    margin-bottom:10px;
  }
  .cardTag .dot{
    width:8px;height:8px;border-radius:50%;
    background:var(--tone);
    box-shadow:0 0 0 7px var(--toneSoft), 0 0 18px rgba(0,0,0,0.35);
  }
  .cardTitle {
    font-size:clamp(15px, 4.2vw, 22px);
    margin:6px 0 10px;
    line-height:1.5;
    letter-spacing:0.01em;
    word-break: normal;
    overflow-wrap:anywhere;
    line-break: loose;
  }
  .cardDesc {
    font-size:clamp(12.5px, 3.7vw, 13px);
    line-height:1.85;
    color:rgba(245,245,247,0.66);
    margin:0;
    word-break: normal;
    overflow-wrap:anywhere;
    line-break: loose;
  }

  .cardGo{
    position:absolute;
    right:12px;
    top:12px;
    width:34px;
    height:34px;
    border-radius:12px;
    display:grid;
    place-items:center;
    border:1px solid rgba(255,255,255,0.12);
    background:rgba(255,255,255,0.035);
    color:rgba(245,245,247,0.62);
    font-weight:900;
    font-size:16px;
  }
  .cardLinkWrap:hover .cardGo{
    color:rgba(245,245,247,0.88);
    border-color: rgba(255,255,255,0.18);
  }

  /* bottom share */
  .shareBottom{
    margin-top:18px;
    padding:14px 14px 16px;
    border-radius:18px;
    background:rgba(10,10,16,0.88);
    border:1px solid var(--border-hair);
    box-shadow:0 18px 50px rgba(0,0,0,0.65);
  }
  .shareTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
  }
  .shareTitle{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:900;
    color:rgba(245,245,247,0.92);
  }
  .shareTitle .globe{
    width:28px;height:28px;border-radius:10px;
    display:grid;place-items:center;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
  }
  .shareTitle .globe svg{ width:18px;height:18px; fill:#e9ecff; opacity:0.92; }
  .helpDot{
    width:22px;height:22px;border-radius:999px;
    display:grid;place-items:center;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
    color:rgba(245,245,247,0.75);
    font-size:12px;
    font-weight:900;
  }
  .urlBox{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .urlInput{
    flex:1 1 360px;
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
    color:rgba(245,245,247,0.92);
    outline:none;
    font-size:13px;
  }
  .urlHint{
    width:100%;
    margin-top:8px;
    font-size:11px;
    line-height:1.6;
    color:rgba(245,245,247,0.55);
  }
  .shareBtns{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:12px;
  }
  .sbtn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    padding:12px 14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
    color:#fff;
    text-decoration:none;
    font-weight:900;
    font-size:13px;
    min-width:160px;
    cursor:pointer;
    transition:transform .14s ease, filter .14s ease, box-shadow .14s ease;
    font-family:inherit;
  }
  .sbtn:hover{ transform:translateY(-1px); filter:brightness(1.06); }
  .sbtn:active{ transform:translateY(0px); }
  .sbtn svg{ width:18px; height:18px; fill:#fff; opacity:0.98; }
  .sbtn.fb{
    background:linear-gradient(180deg, rgba(24,119,242,0.95), rgba(24,119,242,0.78));
    border-color:rgba(24,119,242,0.35);
    box-shadow:0 10px 28px rgba(24,119,242,0.18);
  }
  .sbtn.line{
    background:linear-gradient(180deg, rgba(6,199,85,0.95), rgba(6,199,85,0.78));
    border-color:rgba(6,199,85,0.35);
    box-shadow:0 10px 28px rgba(6,199,85,0.18);
  }
  .sbtn.x{
    background:linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
    border-color:rgba(255,255,255,0.12);
  }
  .sbtn.copy{
    background:linear-gradient(180deg, rgba(35,255,209,0.18), rgba(35,255,209,0.08));
    border-color:rgba(35,255,209,0.20);
    box-shadow:0 10px 28px rgba(35,255,209,0.12);
  }
  .copyToastBottom{
    margin-top:10px;
    min-height:14px;
    font-size:11px;
    color:rgba(245,245,247,0.62);
  }

  /* footer links */
  .siteFooter{
    margin-top:16px;
    padding-top:14px;
    border-top:1px solid rgba(255,255,255,0.06);
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .footerLinks{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:center;
    line-height:1.2;
  }
  .footerLinks a,
  .footerLinks button{
    appearance:none;
    border:none;
    background:transparent;
    padding:0;
    margin:0;
    cursor:pointer;
    color:rgba(245,245,247,0.52);
    font-size:12px;
    text-decoration:none;
    transition:color .14s ease, opacity .14s ease;
    font-family:inherit;
  }
  .footerLinks a:hover,
  .footerLinks button:hover{ color:rgba(245,245,247,0.82); }
  .footerSep{ color:rgba(245,245,247,0.16); font-size:11px; user-select:none; }
  .copyright{ font-size:11px; color:rgba(245,245,247,0.34); }

  /* ✅ モーダル内フォーム（お問い合わせ用） */
  .formRow{ display:flex; flex-direction:column; gap:6px; margin-top:10px; }
  .formRow label{ font-size:11px; color:rgba(245,245,247,0.62); }
  .inp, .ta{
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
    color:rgba(245,245,247,0.92);
    outline:none;
    font-size:13px;
  }
  .ta{ min-height:140px; resize:vertical; }
  .formActions{
    display:flex;
    gap:10px;
    margin-top:12px;
    flex-wrap:wrap;
  }
  .btn{
    appearance:none;
    border:none;
    cursor:pointer;
    font-family:inherit;
    font-weight:900;
    font-size:13px;
    border-radius:999px;
    padding:12px 14px;
    color:#fff;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.12);
    transition:transform .14s ease, filter .14s ease, background .14s ease, border-color .14s ease;
  }
  .btn:hover{ transform:translateY(-1px); filter:brightness(1.06); background:rgba(255,255,255,0.08); }
  .btn:active{ transform:translateY(0px); }
  .btnPrimary{
    color:#050814;
    background:linear-gradient(180deg, rgba(91,255,156,0.95), rgba(91,255,156,0.78));
    border-color:rgba(91,255,156,0.18);
    box-shadow:0 0 18px rgba(91,255,156,0.18);
  }
  .btnPrimary:hover{ background:#7affb2; }
  .formToast{
    margin-top:10px;
    min-height:14px;
    font-size:11px;
    color:rgba(245,245,247,0.62);
  }
  .dl{
    margin:10px 0 0;
    display:grid;
    grid-template-columns: 110px 1fr;
    gap:8px 10px;
    font-size:12px;
    line-height:1.8;
    color:rgba(245,245,247,0.78);
  }
  .dl dt{ color:rgba(245,245,247,0.55); }
  .dl dd{ margin:0; }
  .miniNote{
    margin-top:10px;
    font-size:11px;
    color:rgba(245,245,247,0.55);
    line-height:1.7;
  }
  .hr{
    height:1px;
    background:rgba(255,255,255,0.08);
    border:0;
    margin:12px 0;
  }

  /* modal */
  .modalOverlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.62);
    backdrop-filter:blur(8px);
    display:none;
    align-items:center;
    justify-content:center;
    padding:16px;
    z-index:9999;
  }
  .modalOverlay.show{ display:flex; }
  .modal{
    width:min(920px, 100%);
    max-height:min(82vh, 760px);
    border-radius:20px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(10,10,16,0.92);
    box-shadow:0 26px 90px rgba(0,0,0,0.78);
    display:flex;
    flex-direction:column;
  }
  .modalHeader{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:12px 14px;
    border-bottom:1px solid rgba(255,255,255,0.08);
    background:rgba(5,5,8,0.55);
  }
  .modalTitle{ font-weight:900; font-size:13px; color:rgba(245,245,247,0.92); }
  .modalClose{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:36px;height:32px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.03);
    color:rgba(245,245,247,0.85);
    cursor:pointer;
  }
  .modalClose:hover{ background:rgba(255,255,255,0.06); }
  .modalBody{
    padding:14px 16px 18px;
    overflow:auto;
    color:rgba(245,245,247,0.84);
    line-height:1.9;
    font-size:12px;
  }
  .modalBody h2{ margin:10px 0 8px; font-size:13px; color:rgba(245,245,247,0.92); }
  .modalBody h3{ margin:12px 0 6px; font-size:12px; color:rgba(245,245,247,0.90); }
  .modalBody p, .modalBody li{ color:rgba(245,245,247,0.78); }
  .modalBody ul{ padding-left:18px; margin:6px 0 12px; }
  .modalBody .small{ font-size:11px; color:rgba(245,245,247,0.60); }
  .modalBody a{ color:var(--accent); }

  /* responsive */
  @media (max-width: 860px){
    .heroGrid { grid-template-columns: 1fr; }
    .cards { grid-template-columns: 1fr; }
  }
  @media (max-width: 640px){
    .page { padding:14px 12px 38px; }
    header{ flex-direction:column; align-items:stretch; gap:10px; }
    .headerRight{ flex-direction:column; align-items:stretch; gap:10px; }
    nav a, nav button{ padding:12px 14px; font-size:14px; }
    .hero{ padding:18px 14px; border-radius:20px; }
    .heroTag{
      font-size:12px;
      padding:8px 10px;
      white-space:normal;
      line-height:1.3;
    }
    .br-sm{ display:inline; }
    .heroTitle{
      line-height:1.72;
      font-size:clamp(18px, 6.0vw, 24px);
    }
    .heroLead{
      line-height:1.95;
      font-size:clamp(13px, 4.2vw, 14px);
    }
    .heroPanel{ padding:16px 14px 16px; }
    #pollQuestion{ font-size:14px !important; line-height:1.55 !important; }
    #pollHint{ font-size:12px !important; line-height:1.6 !important; }
    .pollBtn{ padding:14px 12px; font-size:14px; }
    .pollBtnPct{ font-size:13px; }
    .pollBtnLabel{ max-width:70%; }
    .shareBtns .sbtn{
      width:100%;
      min-width:0;
      justify-content:flex-start;
      padding-left:16px;
      padding-top:14px;
      padding-bottom:14px;
      font-size:14px;
    }
    .urlInput{ font-size:14px; padding:14px 12px; }
    .footerLinks{ gap:10px; }
    .footerSep{ display:none; }
  }
  </style>
</head>

<body>
  <div class="page" id="pageRoot">

    <!-- ✅ JSが落ちても「何も見えない」を防ぐ表示 -->
    <div class="hardFallback" id="hardFallback">
      <strong>表示トラブル検知</strong><br>
      JavaScript でエラーが発生している可能性があります。<br>
      右クリック → <code>検証</code> → <code>Console</code> の赤いエラーを確認してください。
      <div style="margin-top:8px;opacity:.9" id="hardFallbackMsg"></div>
    </div>

    <header>
      <div class="logoArea">
        <a class="logoLink" href="index.html" aria-label="トップページへ戻る">
          <div style="min-width:0;">
            <div class="logoTextMain">FoodDeliveryEye</div>
            <div class="logoTextSub">配達員の体験を、みんなの安心と効率へ</div>
          </div>
        </a>
      </div>

      <div class="headerRight">
        <nav>
          <a id="navAbout" href="about.html">このサイトについて</a>
          <a id="navLogin" href="login.html?next=index.html&v=20251220">ログイン</a>
          <a id="navSignup" href="signup.html" class="primary">新規登録</a>

          <a id="navLoggedIn" href="mypage.html" style="display:none;">
            <span class="loggedLamp" aria-hidden="true"></span>
            ログイン中
          </a>
          <button id="navLogout" type="button" class="logoutPill" style="display:none;">ログアウトする</button>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="heroGlow"></div>

      <div class="heroGrid">
        <div class="heroContent">
          <div class="heroTag">
            <span class="dot"></span>
            配達員コミュニティ × 体験データ共有
          </div>

          <h2 class="heroTitle">
            配達の現場で役立つ情報を<br class="br-sm">
            <strong>みんなで集めて共有するサイト</strong>
          </h2>

          <p class="heroLead">
            待ち時間・入館方法・配達のコツなど、現場の体験を共有して、
            日々の配達を少しでもスムーズに。
          </p>
        </div>

        <aside class="heroPanel" id="pollPanel">
          <div class="heroPanelHeader">
            <div class="heroPanelTitle" id="pollPanelTitle">アンケート実施中</div>
            <div style="display:flex;gap:4px;">
              <span style="width:6px;height:6px;border-radius:50%;background:#ffb84d;"></span>
              <span style="width:6px;height:6px;border-radius:50%;background:#6bffb3;"></span>
              <span style="width:6px;height:6px;border-radius:50%;background:#6b7bff;"></span>
            </div>
          </div>

          <div style="margin-top:6px;">
            <div id="pollQuestion" style="font-size:12px;font-weight:900;color:#e9ecff;line-height:1.4;">
              読み込み中…
            </div>
            <div id="pollHint" style="margin-top:6px;font-size:10px;color:#a7aed0;line-height:1.5;">
              選択すると結果が反映されます。
            </div>
          </div>

          <div id="pollChoices" style="margin-top:12px; display:flex; flex-direction:column; gap:8px;"></div>

          <div id="pollMetaLine" style="margin-top:10px; font-size:10px; color:#a7aed0; line-height:1.5;"></div>
          <div id="pollMsg" style="margin-top:6px; font-size:10px; color:#a7aed0; line-height:1.5;"></div>
        </aside>
      </div>
    </section>

    <h3 class="sectionTitle">
      できること
      <span>目的から選べます</span>
    </h3>

    <div class="cards">
      <a class="cardLinkWrap" href="vote.html" aria-label="調理待ち時間へ">
        <article class="card" data-tone="feature">
          <div class="cardGo" aria-hidden="true">↗</div>
          <div class="cardTag"><span class="dot"></span>Feature ・ 待ち時間</div>
          <h4 class="cardTitle">調理待ち時間</h4>
          <p class="cardDesc">
            待ち時間の体感を投票で集計。お店ごとの傾向を見ながら、次の動き方の参考にできます。
          </p>
        </article>
      </a>

      <a class="cardLinkWrap" href="tower.html" aria-label="マンション入館方法へ">
        <article class="card" data-tone="guide">
          <div class="cardGo" aria-hidden="true">↗</div>
          <div class="cardTag"><span class="dot"></span>Guide ・ 入館</div>
          <h4 class="cardTitle">マンション入館方法</h4>
          <p class="cardDesc">
            受付の手順、防災センター経由が必要かどうか等、建物ごとの「入館の流れ」を共有できます。
          </p>
        </article>
      </a>

      <a class="cardLinkWrap" href="bbs.html" aria-label="掲示板へ">
        <article class="card" data-tone="comm">
          <div class="cardGo" aria-hidden="true">↗</div>
          <div class="cardTag"><span class="dot"></span>Community ・ 交流</div>
          <h4 class="cardTitle">掲示板</h4>
          <p class="cardDesc">
            待機のコツやルートの工夫など、配達の工夫を気軽に共有。役立つ情報が見つかるかもしれません。
          </p>
        </article>
      </a>

      <a class="cardLinkWrap" href="poll.html" aria-label="アンケートへ">
        <article class="card" data-tone="poll">
          <div class="cardGo" aria-hidden="true">↗</div>
          <div class="cardTag"><span class="dot"></span>Poll ・ アンケート</div>
          <h4 class="cardTitle">アンケート</h4>
          <p class="cardDesc">
            みんなの本音は？結果を見て、動き方のヒントにできます。
          </p>
        </article>
      </a>
    </div>

    <section class="shareBottom" aria-label="サイト共有リンク">
      <div class="shareTop">
        <div class="shareTitle">
          <span class="globe" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm7.9 9h-3.2a15.7 15.7 0 0 0-1.2-6 8 8 0 0 1 4.4 6ZM12 4c.9 1.2 1.8 3.5 2.1 7H9.9c.3-3.5 1.2-5.8 2.1-7Zm-6.3 7H4.1a8 8 0 0 1 4.4-6 15.7 15.7 0 0 0-1.2 6Zm0 2c.1 2.2.6 4.2 1.2 6a8 8 0 0 1-2.8-6h1.6Zm4.2 0h4.2c-.3 3.5-1.2 5.8-2.1 7-.9-1.2-1.8-3.5-2.1-7Zm6.3 0h3.2a8 8 0 0 1-2.8 6c.6-1.8 1.1-3.8 1.2-6Z"/></svg>
          </span>
          <span>このサイトのURL</span>
        </div>
        <div class="helpDot" title="共有用リンクです">?</div>
      </div>

      <div class="urlBox">
        <input class="urlInput" id="siteUrl" type="text" readonly value="" aria-label="サイトURL">
        <div class="urlHint">ボタンを押すと、このサイトのURLを共有できます。</div>
      </div>

      <div class="shareBtns">
        <a class="sbtn x" id="shareXBottom" href="#" target="_blank" rel="noopener" aria-label="Xで共有">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18.9 2H22l-6.8 7.8L23 22h-6.8l-5.3-6.7L4.8 22H2l7.4-8.5L1 2h7l4.8 6.1L18.9 2Zm-2.4 18h1.9L7.3 3.9H5.2L16.5 20Z"/></svg>
          <span>Xにポスト</span>
        </a>

        <a class="sbtn fb" id="shareFBBottom" href="#" target="_blank" rel="noopener" aria-label="Facebookで共有">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M13.5 22v-8h2.7l.4-3H13.5V9.1c0-.9.3-1.6 1.6-1.6h1.5V5a20 20 0 0 0-2.2-.1c-2.2 0-3.7 1.3-3.7 3.8V11H8v3h2.7v8h2.8Z"/></svg>
          <span>Facebookで共有</span>
        </a>

        <a class="sbtn line" id="shareLineBottom" href="#" target="_blank" rel="noopener" aria-label="LINEで共有">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3C6.9 3 3 6.3 3 10.4c0 2.5 1.4 4.7 3.7 6.1l-.6 3.3c-.1.5.4.9.9.6l3.8-2.1c.7.1 1.4.2 2.2.2 5.1 0 9-3.3 9-7.4S17.1 3 12 3Zm-3 8.5h-1V9h1v2.5Zm3 0h-1V9h1v2.5Zm3 0h-1V9h1v2.5Z"/></svg>
          <span>LINEで送る</span>
        </a>

        <button class="sbtn copy" id="copyBottom" type="button" aria-label="URLをコピー">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16 1H6C4.9 1 4 1.9 4 3v12h2V3h10V1Zm3 4H10c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2Zm0 16H10V7h9v14Z"/></svg>
          <span>URLをコピー</span>
        </button>
      </div>

      <div class="copyToastBottom" id="copyToastBottom"></div>
    </section>

    <footer class="siteFooter" aria-label="フッター">
      <div class="footerLinks" aria-label="規約リンク">
        <button type="button" data-open="terms">利用規約</button>
        <span class="footerSep">•</span>
        <button type="button" data-open="privacy">プライバシーポリシー</button>
        <span class="footerSep">•</span>
        <button type="button" data-open="guideline">コミュニティガイドライン</button>
        <span class="footerSep">•</span>
        <button type="button" data-open="disclaimer">免責事項</button>
        <span class="footerSep">•</span>
        <button type="button" data-open="operator">運営者情報</button>
        <span class="footerSep">•</span>
        <button type="button" data-open="contact">お問い合わせ</button>
      </div>
      <div class="copyright">© FoodDeliveryEye – 配達員のための情報レーダー</div>
    </footer>

  </div>

  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHeader">
        <div class="modalTitle" id="modalTitle">タイトル</div>
        <button class="modalClose" id="modalClose" type="button" aria-label="閉じる">✕</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <!-- ✅ テンプレ群（内容あり） -->
  <template id="tpl-terms">
    <h2>利用規約</h2>
    <p class="small">最終更新日：2025年12月20日</p>
    <p>この利用規約（以下「本規約」）は、FoodDeliveryEye（以下「当サイト」）が提供する各種サービス（以下「本サービス」）の利用条件を定めるものです。利用者は、本規約に同意の上で本サービスを利用するものとします。</p>
    <h3>第1条（適用）</h3>
    <ul>
      <li>本規約は、利用者と当サイト運営者との間の本サービス利用に関わる一切の関係に適用されます。</li>
      <li>当サイトは本サービスに関し、本規約のほか、個別のルール・ガイドライン・注意事項等（以下「個別規定」）を定めることがあります。個別規定は本規約の一部を構成します。</li>
      <li>本規約と個別規定が矛盾する場合、特段の定めがない限り個別規定が優先されます。</li>
    </ul>
    <h3>第2条（利用登録）</h3>
    <ul>
      <li>利用登録は、当サイト所定の方法により登録を申請し、当サイトが承認した時点で完了します。</li>
      <li>当サイトは、申請者に以下の事由があると判断した場合、登録を承認しないことがあります。
        <ul>
          <li>虚偽の事項を届け出た場合</li>
          <li>過去に規約違反等により利用停止等の処分を受けたことがある場合</li>
          <li>その他、当サイトが登録を相当でないと判断した場合</li>
        </ul>
      </li>
    </ul>
    <h3>第3条（アカウント管理）</h3>
    <ul>
      <li>利用者は自己の責任においてID・パスワード等を適切に管理するものとします。</li>
      <li>当サイトは、登録された情報によりログインが行われた場合、利用者本人による利用とみなします。</li>
    </ul>
    <h3>第4条（禁止事項）</h3>
    <p>利用者は以下の行為をしてはなりません。</p>
    <ul>
      <li>法令または公序良俗に違反する行為</li>
      <li>他者の権利（著作権、商標権、プライバシー、名誉等）を侵害する行為</li>
      <li>個人情報の投稿（氏名・電話・住所・部屋番号・顔写真等）や、特定個人の追跡・晒しに繋がる行為</li>
      <li>虚偽情報・なりすまし・誤解を招く表現</li>
      <li>スパム、広告、勧誘、過度な宣伝、同一内容の連投</li>
      <li>当サイトの運営を妨害する行為、過度な負荷をかける行為</li>
      <li>不正アクセス、リバースエンジニアリング、脆弱性の悪用</li>
      <li>その他、当サイトが不適切と判断する行為</li>
    </ul>
    <h3>第5条（投稿・コンテンツの取扱い）</h3>
    <ul>
      <li>利用者が投稿した内容（レビュー、掲示板、投票、アンケート等）は、利用者自身が責任を負います。</li>
      <li>当サイトは、運営・改善・不正対策・品質向上のため、投稿内容を表示・編集（軽微な整形）・非表示・削除することがあります。</li>
      <li>利用者は、投稿について、当サイトに対し本サービス提供に必要な範囲での利用（表示、複製、翻案、要約等）を許諾するものとします。</li>
    </ul>
    <h3>第6条（サービスの変更・停止）</h3>
    <ul>
      <li>当サイトは、事前の通知なく本サービスの内容を変更し、または提供を停止・中断することがあります。</li>
      <li>これにより利用者に生じた損害について、当サイトは責任を負いません（ただし、故意または重過失がある場合を除く）。</li>
    </ul>
    <h3>第7条（利用制限・登録抹消）</h3>
    <ul>
      <li>当サイトは、利用者が本規約に違反した場合、事前通知なく投稿の削除、利用制限、登録抹消等の措置を講じることがあります。</li>
    </ul>
    <h3>第8条（免責）</h3>
    <ul>
      <li>当サイトに掲載される情報は利用者投稿等に基づくものであり、その正確性・完全性・有用性を保証しません。</li>
      <li>本サービス利用により生じたトラブル・損害について、当サイトは責任を負いません（ただし、故意または重過失がある場合を除く）。</li>
    </ul>
    <h3>第9条（準拠法・裁判管轄）</h3>
    <ul>
      <li>本規約は日本法を準拠法とします。</li>
      <li>本サービスに関して紛争が生じた場合、運営者所在地を管轄する裁判所を第一審の専属的合意管轄裁判所とします。</li>
    </ul>
  </template>

  <template id="tpl-privacy">
    <h2>プライバシーポリシー</h2>
    <p class="small">最終更新日：2025年12月20日</p>
    <p>FoodDeliveryEye（以下「当サイト」）は、利用者のプライバシーを尊重し、個人情報の保護に努めます。本ポリシーは、当サイトにおける個人情報等の取扱いについて定めるものです。</p>
    <h3>1. 取得する情報</h3>
    <ul>
      <li><b>アカウント情報</b>：メールアドレス、ユーザーID、認証情報等（登録・ログインのため）</li>
      <li><b>投稿情報</b>：掲示板投稿、投票内容、アンケート回答、レビュー等、利用者が入力した内容</li>
      <li><b>利用情報</b>：アクセスログ、端末情報、ブラウザ情報、IPアドレス、Cookie 等（解析・不正対策・安定運用のため）</li>
      <li><b>お問い合わせ情報</b>：氏名（任意）、メールアドレス、問い合わせ内容等</li>
    </ul>
    <h3>2. 利用目的</h3>
    <ul>
      <li>本サービスの提供・運営、本人確認、認証</li>
      <li>投稿・投票・アンケート等の機能提供および不正防止</li>
      <li>お問い合わせ対応、重要なお知らせの連絡</li>
      <li>利用状況の分析、品質改善、障害対応</li>
      <li>規約違反等への対応、セキュリティ確保</li>
    </ul>
    <h3>3. 第三者提供</h3>
    <p>当サイトは、法令に基づく場合を除き、本人の同意なく個人情報を第三者に提供しません。</p>
    <h3>4. 委託</h3>
    <p>当サイトは、サーバー運用、解析等の目的で、個人情報の取扱いを外部に委託することがあります。この場合、適切な委託先を選定し、必要な監督を行います。</p>
    <h3>5. Cookie 等の利用</h3>
    <ul>
      <li>当サイトはログイン状態の保持、利便性向上、不正対策のため Cookie 等を使用する場合があります。</li>
      <li>ブラウザ設定により Cookie を無効にできますが、一部機能が利用できなくなる場合があります。</li>
    </ul>

    <!-- ✅ ここを追加（指定文言） -->
    <p>当サイトでは第三者配信の広告サービス（Google AdSense）を利用しています。<br>
    広告配信事業者はユーザーの興味に応じた広告を表示するためCookieを使用することがあります。</p>

    <h3>6. 安全管理</h3>
    <p>当サイトは、個人情報への不正アクセス、漏えい、滅失または毀損の防止等のため、必要かつ適切な安全管理措置を講じます。</p>
    <h3>7. 開示・訂正・削除等</h3>
    <p>本人から、保有個人情報の開示・訂正・削除・利用停止等の請求があった場合、本人確認の上、法令に従い適切に対応します。</p>
    <h3>8. お問い合わせ窓口</h3>
    <p>本ポリシーに関するお問い合わせは、当サイトの「お問い合わせ」よりご連絡ください。</p>
    <h3>9. 改定</h3>
    <p>当サイトは、本ポリシーを必要に応じて改定することがあります。改定後の内容は当サイト上での掲示等により周知します。</p>
  </template>

  <template id="tpl-guideline">
    <h2>コミュニティガイドライン</h2>
    <p class="small">最終更新日：2025年12月20日</p>
    <p>当サイトは、配達員の体験共有を安全に行うため、以下のガイドラインを定めます。みなさんが気持ちよく使えるよう、ご協力をお願いします。</p>
    <h3>1. 安全第一</h3>
    <ul>
      <li>個人が特定される情報（氏名、電話、住所、部屋番号、顔写真など）は投稿しないでください。</li>
      <li>建物や店舗の情報も、セキュリティに配慮し、過度に詳細な導線や突破手順の共有は避けてください。</li>
    </ul>
    <h3>2. リスペクト</h3>
    <ul>
      <li>誹謗中傷、差別的表現、攻撃的な言い回しはNGです。</li>
      <li>店舗・住民・配達員同士を尊重し、事実ベースで共有してください。</li>
    </ul>
    <h3>3. 有用性を上げるコツ</h3>
    <ul>
      <li>日時や状況（混雑、天候、時間帯など）を添えると、情報の価値が上がります。</li>
      <li>体験談は主観になりやすいので、「自分の状況ではこうだった」と書くのがおすすめです。</li>
    </ul>
    <h3>4. 禁止される投稿例</h3>
    <ul>
      <li>個人情報の晒し、脅迫、嫌がらせ</li>
      <li>違法行為の助長、危険行為の推奨</li>
      <li>スパム、宣伝、誘導（外部サービスへの過度な誘導含む）</li>
    </ul>
    <h3>5. 運営対応</h3>
    <p>通報や運営判断により、投稿の非表示・削除、アカウント制限等の措置を行う場合があります。</p>
  </template>

  <template id="tpl-disclaimer">
    <h2>免責事項</h2>
    <p class="small">最終更新日：2025年12月20日</p>
    <ul>
      <li>当サイトに掲載される情報は、利用者の投稿等に基づくものであり、その正確性・完全性・有用性を保証しません。</li>
      <li>当サイトの情報を利用したことにより生じた損害・トラブルについて、当サイトは一切の責任を負いません（ただし、故意または重過失がある場合を除きます）。</li>
      <li>当サイトからリンクされている外部サイトの内容について、当サイトは責任を負いません。</li>
      <li>本サービスは予告なく変更・停止される場合があります。</li>
    </ul>
  </template>

  <template id="tpl-operator">
    <h2>運営者情報</h2>
    <p class="small">最終更新日：2025年12月20日</p>
    <p>当サイトは、配達員の体験共有を通じて、安全と効率の向上に役立つ情報を集めることを目的として運営しています。</p>

    <dl class="dl">
      <dt>運営</dt><dd>FoodDeliveryEye 運営</dd>
      <dt>連絡先</dt><dd><span id="operatorEmailInModal">fooddeliveryeye@gmail.com</span></dd>
      <dt>所在地</dt><dd>（個人運営のため請求があれば遅滞なく開示します）</dd>
      <dt>対応時間</dt><dd>原則 48時間以内の返信を目安</dd>
    </dl>

    <hr class="hr">
    <p class="miniNote">※削除依頼・権利侵害・プライバシーに関するご相談は「お問い合わせ」からご連絡ください。</p>
  </template>

  <template id="tpl-contact">
    <h2>お問い合わせ</h2>
    <p class="small">最終更新日：2025年12月20日</p>

    <p>ご意見・不具合報告・削除依頼などはこちらからお送りください。</p>

    <form id="contactForm" novalidate>
      <div class="formRow">
        <label for="cName">お名前（任意）</label>
        <input class="inp" id="cName" name="name" type="text" placeholder="例）山田 太郎">
      </div>

      <div class="formRow">
        <label for="cEmail">メールアドレス（必須）</label>
        <input class="inp" id="cEmail" name="email" type="email" required placeholder="例）example@gmail.com">
      </div>

      <div class="formRow">
        <label for="cCategory">種別</label>
        <select class="inp" id="cCategory" name="category">
          <option value="general">一般のお問い合わせ</option>
          <option value="report">不適切投稿の通報</option>
          <option value="privacy">個人情報/プライバシー</option>
          <option value="rights">権利侵害（削除依頼等）</option>
          <option value="bug">不具合報告</option>
          <option value="business">提携・取材</option>
        </select>
      </div>

      <div class="formRow">
        <label for="cMessage">内容（必須）</label>
        <textarea class="ta" id="cMessage" name="message" required placeholder="対象ページURLや状況など、できるだけ具体的にお願いします。"></textarea>
      </div>

      <div class="formActions">
        <button class="btn btnPrimary" type="submit">送信する</button>
        <button class="btn" type="button" id="contactClear">クリア</button>
      </div>

      <div class="formToast" id="contactToast"></div>
      <div class="miniNote">
        ※このフォームはフロントのみ（デモ）です。本番は PocketBase のコレクションに保存、またはメール送信APIに接続してください。
      </div>
    </form>
  </template>

  <!-- ✅ PocketBase（落ちてもページが消えないようにJS側で保険してる） -->
  <script src="https://cdn.jsdelivr.net/npm/pocketbase@0.21.1/dist/pocketbase.umd.js"></script>

  <script>
  (() => {
    // ✅ 画面が「背景だけ」になった時に原因を出す（保険）
    const hardFallback = document.getElementById("hardFallback");
    const hardFallbackMsg = document.getElementById("hardFallbackMsg");
    function showHardFallback(msg){
      if(!hardFallback) return;
      hardFallback.style.display = "block";
      if(hardFallbackMsg) hardFallbackMsg.textContent = msg || "";
    }
    window.addEventListener("error", (e) => {
      showHardFallback("JSエラー: " + (e?.message || "unknown"));
    });
    window.addEventListener("unhandledrejection", (e) => {
      const m = e?.reason?.message || e?.reason || "unknown";
      showHardFallback("Promiseエラー: " + m);
    });

    // ====== ここから元ロジック（落ちないように try/catchで包む） ======
    let pb = null;
    const PB_URL = "https://delivery-eye.onrender.com";

    // nav
    const navAbout = document.getElementById("navAbout");
    const navLogin = document.getElementById("navLogin");
    const navSignup = document.getElementById("navSignup");
    const navLoggedIn = document.getElementById("navLoggedIn");
    const navLogout = document.getElementById("navLogout");

    try{
      const v = "20251220";
      const nextUrl = "index.html";
      const fixed = "login.html?next=" + encodeURIComponent(nextUrl) + "&v=" + encodeURIComponent(v);
      if(navLogin) navLogin.href = fixed;
    }catch{}

    function setNavLoggedIn(isLoggedIn){
      if(isLoggedIn){
        if(navAbout) navAbout.style.display = "none";
        if(navLogin) navLogin.style.display = "none";
        if(navSignup) navSignup.style.display = "none";

        if(navLoggedIn){
          navLoggedIn.style.display = "";
          navLoggedIn.classList.add("loggedPill");
        }
        if(navLogout) navLogout.style.display = "";
      }else{
        if(navAbout) navAbout.style.display = "";
        if(navLogin) navLogin.style.display = "";
        if(navSignup) navSignup.style.display = "";

        if(navLoggedIn){
          navLoggedIn.style.display = "none";
          navLoggedIn.classList.remove("loggedPill");
        }
        if(navLogout) navLogout.style.display = "none";
      }
    }

    // poll UI refs
    const elQ = document.getElementById("pollQuestion");
    const elChoices = document.getElementById("pollChoices");
    const elMetaLine = document.getElementById("pollMetaLine");
    const msgBox = document.getElementById("pollMsg");

    const errText = (e)=> (e?.data?.message || e?.message || String(e));

    // ✅ PocketBaseが読み込めない時のフォールバック（ここが今回のキモ）
    function renderPollFallback(reason){
      if(elQ) elQ.textContent = "現在、アンケートを読み込めません。";
      if(elChoices) elChoices.innerHTML = "";
      if(elMetaLine) elMetaLine.textContent = "";
      if(msgBox) msgBox.textContent = reason || "PocketBaseに接続できませんでした。";
      // ログイン機能も止まるので、ログインUIは通常表示のままにする
      setNavLoggedIn(false);
    }

    // ✅ PocketBase 初期化（失敗してもページは見える）
    try{
      if(!window.PocketBase) throw new Error("PocketBase CDN が読み込めませんでした");
      pb = new window.PocketBase(PB_URL);
      if (typeof pb.autoCancellation === "function") pb.autoCancellation(false);
    }catch(e){
      console.error(e);
      renderPollFallback(errText(e));
      // ここで終了（ただしページ自体は見える）
      // share / modalだけは動かすため、続行する
    }

    async function ensureAuthModel(){
      if(!pb) return;
      if(!pb.authStore.isValid){
        setNavLoggedIn(false);
        return;
      }
      try{
        if (pb.collection && pb.collection("users")?.authRefresh) {
          await pb.collection("users").authRefresh();
        }
        setNavLoggedIn(true);
      }catch{
        pb.authStore.clear();
        setNavLoggedIn(false);
      }
    }

    // poll state
    let currentTopic = null;
    let choiceKeys = [];
    let choiceLabels = {};
    let isBusy = false;

    function buildChoicesFromTopic(t){
      const keys = [];
      const labels = {};
      const push = (k, v)=>{
        const s = String(v || "").trim();
        if(!s) return;
        keys.push(k);
        labels[k] = s;
      };
      push("c1", t.choice1);
      push("c2", t.choice2);
      push("c3", t.choice3);
      push("c4", t.choice4);
      return { keys, labels };
    }

    function normalizeChoiceKey(v){
      if(!v) return null;
      const s = String(v);
      if(s === "1" || s === "2" || s === "3" || s === "4") return "c" + s;
      if(/^c[1-4]$/.test(s)) return s;
      return null;
    }

    function renderChoiceButtons(counts, total, votedChoiceKey){
      if(!elChoices) return;
      elChoices.innerHTML = "";

      for(const key of choiceKeys){
        const pct = total ? Math.round((counts[key] / total) * 100) : 0;

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "pollBtn";
        btn.dataset.choice = key;
        btn.style.setProperty("--pct", pct + "%");
        btn.innerHTML = `
          <div class="pollBtnInner">
            <span class="pollBtnLabel">${choiceLabels[key]}</span>
            <span class="pollBtnPct">${pct}%</span>
          </div>
        `;

        const voted = !!votedChoiceKey;
        if(voted){
          btn.disabled = true;
          if(key === votedChoiceKey){
            btn.style.borderColor = "rgba(91,255,156,0.35)";
          }
        }

        btn.addEventListener("click", async ()=>{
          if(!pb || !currentTopic || isBusy) return;

          if(!pb.authStore.isValid){
            if(msgBox){
              msgBox.innerHTML = `
                <div style="margin-top:6px;">
                  🔒 <strong style="color:#e9ecff;">投票にはログインが必要です</strong><br>
                  <span style="font-size:10px;">ログインすると投票が反映されます。</span>
                </div>
                <div style="display:flex; gap:8px; margin-top:10px;">
                  <a href="login.html?next=${encodeURIComponent("index.html")}&v=20251220" class="pollCta">ログイン</a>
                  <a href="signup.html" class="pollCta pollCtaPrimary">新規登録</a>
                </div>
              `;
            }
            return;
          }

          isBusy = true;
          if(msgBox) msgBox.textContent = "投票を反映中…";
          Array.from(elChoices.querySelectorAll("button")).forEach(b => b.disabled = true);

          try{
            await saveVoteOnce(currentTopic.id, key);
            await refreshResults();
            if(msgBox) msgBox.textContent = "投票済みです。";
          }catch(e){
            const m = errText(e);
            console.error(e);
            if (String(m).includes("already") || String(m).includes("unique") || String(m).includes("409")) {
              await refreshResults();
              if(msgBox) msgBox.textContent = "投票済みです。";
            } else {
              if(msgBox) msgBox.textContent = "投票に失敗しました。";
              await refreshResults();
            }
          }finally{
            isBusy = false;
          }
        });

        elChoices.appendChild(btn);
      }
    }

    async function fetchActiveTopic(){
      const res = await pb.collection("poll_topics").getList(1, 1, {
        filter: `status="active" && published=true`,
        sort: "-created"
      });
      return res?.items?.[0] || null;
    }

    async function getMyVote(topicId){
      if(!pb || !pb.authStore.isValid) return null;
      const me = pb.authStore.model?.id;
      if(!me) return null;

      try{
        const item = await pb.collection("polls").getFirstListItem(
          `topic="${topicId}" && user="${me}"`
        );

        return (
          normalizeChoiceKey(item?.choiceKey) ||
          normalizeChoiceKey(item?.choice) ||
          normalizeChoiceKey(item?.choiceIndex)
        );
      }catch{
        return null;
      }
    }

    async function fetchAllVotes(topicId){
      const items = await pb.collection("polls").getFullList({
        filter: `topic="${topicId}"`,
        sort: "-created"
      });
      return items || [];
    }

    async function saveVoteOnce(topicId, choiceKey){
      const me = pb.authStore.model?.id;
      if(!me) throw new Error("not logged in");

      const existing = await getMyVote(topicId);
      if(existing) return;

      const idx = Number(String(choiceKey).replace("c","")) || 0;

      await pb.collection("polls").create({
        topic: topicId,
        user: me,
        choiceKey: choiceKey,
        choiceIndex: idx,
        choice: choiceKey
      });
    }

    async function refreshResults(){
      if(!pb || !currentTopic) return;

      const votes = await fetchAllVotes(currentTopic.id);

      const counts = {};
      for(const k of choiceKeys) counts[k] = 0;

      for(const v of votes){
        const key =
          normalizeChoiceKey(v?.choiceKey) ||
          normalizeChoiceKey(v?.choice) ||
          normalizeChoiceKey(v?.choiceIndex);

        if(key && counts[key] !== undefined) counts[key]++;
      }

      const total = votes.length;
      const myChoice = await getMyVote(currentTopic.id);

      renderChoiceButtons(counts, total, myChoice);
      if(elMetaLine) elMetaLine.textContent = total + "人が回答";
      if(msgBox) msgBox.textContent = myChoice ? "投票済みです。" : "";
    }

    async function bootPollPanel(){
      if(!pb){
        renderPollFallback("PocketBase未接続（CDN/ネットワーク/URLを確認）");
        return;
      }

      if(msgBox) msgBox.textContent = "";
      if(elMetaLine) elMetaLine.textContent = "";

      try{
        currentTopic = await fetchActiveTopic();

        if(!currentTopic){
          if(elQ) elQ.textContent = "現在、公開中のアンケートはありません。";
          if(elChoices) elChoices.innerHTML = "";
          return;
        }

        if(elQ) elQ.textContent = currentTopic.question || "アンケート";

        const built = buildChoicesFromTopic(currentTopic);
        choiceKeys = built.keys;
        choiceLabels = built.labels;

        if(choiceKeys.length < 2){
          if(elChoices) elChoices.innerHTML = `<div style="font-size:10px;color:#a7aed0">選択肢が不足しています。</div>`;
          return;
        }

        await refreshResults();
      }catch(e){
        console.error(e);
        if(elQ) elQ.textContent = "読み込みに失敗しました。";
        if(msgBox) msgBox.textContent = errText(e);
        showHardFallback("Poll読み込み失敗: " + errText(e));
      }
    }

    // nav logout
    setNavLoggedIn(!!(pb && pb.authStore && pb.authStore.isValid));
    if(navLogout){
      navLogout.addEventListener("click", async () => {
        const ok = window.confirm("ログアウトしますか？");
        if(!ok) return;

        if(pb) pb.authStore.clear();
        setNavLoggedIn(false);
        if(msgBox) msgBox.textContent = "";
        try{ await refreshResults(); }catch{}
      });
    }

    // share（ここもnull安全）
    const pageUrl = window.location.href;
    const shareText = "FoodDeliveryEye：配達員の体験を、みんなの安心と効率へ";

    const siteUrlInput = document.getElementById("siteUrl");
    const shareXBottom = document.getElementById("shareXBottom");
    const shareFBBottom = document.getElementById("shareFBBottom");
    const shareLineBottom = document.getElementById("shareLineBottom");
    const copyBottom = document.getElementById("copyBottom");
    const toastBottom = document.getElementById("copyToastBottom");

    if(siteUrlInput){
      siteUrlInput.value = pageUrl;
      siteUrlInput.addEventListener("click", () => siteUrlInput.select());
    }
    if(shareXBottom) shareXBottom.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(pageUrl)}`;
    if(shareFBBottom) shareFBBottom.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`;
    if(shareLineBottom) shareLineBottom.href = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(pageUrl)}`;

    function showToastBottom(msg){
      if(!toastBottom) return;
      toastBottom.textContent = msg;
      setTimeout(()=>{ if(toastBottom.textContent === msg) toastBottom.textContent=""; }, 1600);
    }

    if(copyBottom){
      copyBottom.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(pageUrl);
          showToastBottom("コピーしました");
        } catch {
          const tmp = document.createElement("textarea");
          tmp.value = pageUrl;
          document.body.appendChild(tmp);
          tmp.select();
          document.execCommand("copy");
          tmp.remove();
          showToastBottom("コピーしました");
        }
      });
    }

    // modal
    const overlay = document.getElementById("modalOverlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const closeBtn = document.getElementById("modalClose");

    const map = {
      terms:      { title: "利用規約", tpl: "tpl-terms" },
      privacy:    { title: "プライバシーポリシー", tpl: "tpl-privacy" },
      guideline:  { title: "コミュニティガイドライン", tpl: "tpl-guideline" },
      disclaimer: { title: "免責事項", tpl: "tpl-disclaimer" },
      operator:   { title: "運営者情報", tpl: "tpl-operator" },
      contact:    { title: "お問い合わせ", tpl: "tpl-contact" }
    };

    function wireContactFormIfExists(){
      if(!modalBody) return;
      const form = modalBody.querySelector("#contactForm");
      if(!form) return;

      const toast = modalBody.querySelector("#contactToast");
      const clearBtn = modalBody.querySelector("#contactClear");
      const cName = modalBody.querySelector("#cName");
      const cEmail = modalBody.querySelector("#cEmail");
      const cCategory = modalBody.querySelector("#cCategory");
      const cMessage = modalBody.querySelector("#cMessage");

      const toastFn = (msg)=>{
        if(!toast) return;
        toast.textContent = msg;
        setTimeout(()=>{ if(toast.textContent === msg) toast.textContent=""; }, 2200);
      };

      clearBtn?.addEventListener("click", ()=>{
        if(cName) cName.value = "";
        if(cEmail) cEmail.value = "";
        if(cCategory) cCategory.value = "general";
        if(cMessage) cMessage.value = "";
        toastFn("クリアしました");
      });

      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        const email = (cEmail?.value || "").trim();
        const message = (cMessage?.value || "").trim();
        if(!email || !message){
          toastFn("メールアドレスと内容は必須です");
          return;
        }
        toastFn("送信しました（デモ）");
      });
    }

    function openModal(key){
      const item = map[key];
      if(!item || !overlay || !modalTitle || !modalBody) return;
      modalTitle.textContent = item.title;
      const tpl = document.getElementById(item.tpl);
      modalBody.innerHTML = tpl ? tpl.innerHTML : "<p>内容がありません。</p>";

      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";

      wireContactFormIfExists();
    }

    function closeModal(){
      if(!overlay) return;
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    document.querySelectorAll("[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=> openModal(btn.dataset.open));
    });

    if(closeBtn) closeBtn.addEventListener("click", closeModal);
    if(overlay) overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape" && overlay && overlay.classList.contains("show")) closeModal(); });

    (async () => {
      try{
        await ensureAuthModel();
      }catch(e){
        console.error(e);
        showHardFallback("認証更新で失敗: " + errText(e));
      }

      try{
        await bootPollPanel();
      }catch(e){
        console.error(e);
        showHardFallback("初期化で失敗: " + errText(e));
      }
    })();
  })();
  </script>
</body>
</html>
